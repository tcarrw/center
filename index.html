<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Center ¬∑ Cube Keys ‚Üí School Proximity</title>
<style>
  :root{
    --bg: radial-gradient(1200px 800px at 70% -20%, rgba(255,182,193,0.22), transparent),
          radial-gradient(900px 600px at 0% 120%, rgba(182,139,255,0.18), transparent),
          radial-gradient(700px 500px at 100% 100%, rgba(255,236,179,0.14), transparent),
          #0a0a0f;
    --text:#eef1ff; --muted:#c9cbe4;
    --pink:#ff7fb7; --gold:#ffd76a; --violet:#b68cff; --blue:#98c8ff; --green:#9af2c9;
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    display:flex; align-items:center; justify-content:center; padding:24px;
  }
  .wrap{width:min(1100px,100%); display:grid; gap:22px}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
    border:1px solid rgba(255,255,255,0.12);
    border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.06);
    backdrop-filter: blur(10px);
  }
  .eyebrow{font-size:12px; letter-spacing:.25em; text-transform:uppercase; color:var(--muted); margin:18px 18px 6px}
  .title{
    font-weight:700; font-size:22px; margin:0 18px 18px;
    background:linear-gradient(90deg, var(--pink), var(--gold));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }

  .grid{padding:20px; display:grid; grid-template-columns:1.2fr .8fr; gap:18px}
  @media (max-width:960px){.grid{grid-template-columns:1fr}}

  /* Cube area */
  .cube-wrap{
    position:relative; border:1px solid rgba(255,255,255,0.10); border-radius:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    padding:8px;
  }
  svg{width:100%; height:auto; display:block}
  .face{fill:rgba(255,255,255,0.04); stroke:rgba(255,255,255,0.06)}
  .edge{stroke:rgba(255,255,255,0.28); stroke-width:1.2}
  .edge.dim{opacity:.28}
  .node{
    pointer-events:auto; cursor:default;
  }
  .node circle{stroke:rgba(255,255,255,0.65); stroke-width:1.2}
  .node.dim circle{opacity:.35; filter:grayscale(.8)}
  .glow{filter:url(#g);}
  .label{
    font-size:12px; fill:#e9ecff; paint-order:stroke; stroke:#0a0a0f; stroke-width:.6px; letter-spacing:.2px;
  }
  .center-dot{fill:#fff; opacity:.9}
  .center-pulse{
    fill:rgba(255,215,106,0.35); animation:pulse 2.8s ease-in-out infinite;
  }
  @keyframes pulse{0%{transform:scale(.96)}50%{transform:scale(1.04)}100%{transform:scale(.96)}}

  /* Right info */
  .side{
    display:grid; gap:14px; align-content:start; padding:16px;
    background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border:1px solid rgba(255,255,255,0.10); border-radius:14px;
  }
  .stat{display:flex; justify-content:space-between; align-items:center; font-size:13px; color:var(--muted);
        background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.10);
        border-radius:12px; padding:10px 12px}
  .stat b{color:#fff}
  .feedback{font-size:14px; line-height:1.5; color:#f2f2ff; background: rgba(255,255,255,0.04);
            border:1px solid rgba(255,255,255,0.10); border-radius:12px; padding:12px}

  /* Keys list */
  .keys{display:grid; gap:10px; padding:10px; background: rgba(255,255,255,0.04);
        border:1px solid rgba(255,255,255,0.10); border-radius:12px}
  .key-row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  @media (max-width:700px){.key-row{grid-template-columns:1fr}}
  .key{display:flex; align-items:center; justify-content:space-between; gap:12px;
       padding:10px 12px; border-radius:12px; background:rgba(255,255,255,0.05);
       border:1px solid rgba(255,255,255,0.12); transition:opacity .25s ease, filter .25s ease}
  .key.dim{opacity:.45; filter:grayscale(.7)}
  .left{display:flex; align-items:center; gap:10px}
  .dot{width:10px; height:10px; border-radius:50%}
  .p{background:var(--pink)} .g{background:var(--gold)} .v{background:var(--violet)} .b{background:var(--blue)} .gr{background:var(--green)}
  .titlekey{font-size:13px; color:#fff; font-weight:600; letter-spacing:.2px}
  .method{display:inline-flex; align-items:center; gap:8px}
  .badge{font-size:11px; padding:4px 8px; border-radius:999px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.16)}
  .edit{font-size:11px; padding:6px 10px; border-radius:999px; color:#0a0a0f; background:#fff; border:none; cursor:pointer}
  .edit[disabled]{opacity:.5; cursor:not-allowed}
  .selector{display:none; margin-top:8px; padding:10px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); border-radius:10px}
  .selector label{display:inline-flex; align-items:center; gap:6px; margin:4px 8px 0 0; font-size:12px; color:#e9ecff}
  .selector input{accent-color:#ffd76a}

  .missing{display:flex; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted)}
  .chip{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px;
        background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.12)}
  .fine{font-size:11px; color:var(--muted); text-align:center; padding-bottom:4px}
</style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div class="eyebrow">Center</div>
      <h1 class="title">Cube Keys ‚Üí Proximity to School</h1>
      <div class="grid">
        <div class="cube-wrap">
          <svg viewBox="0 0 600 520" aria-label="Cube map">
            <defs>
              <filter id="g"><feGaussianBlur in="SourceGraphic" stdDeviation="2"/></filter>
              <linearGradient id="edgeGrad" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="#ff7fb7"/><stop offset="50%" stop-color="#ffd76a"/><stop offset="100%" stop-color="#b68cff"/>
              </linearGradient>
            </defs>

            <!-- Faces (three visible sides) -->
            <polygon id="face-top" class="face" points="150,120 300,50 450,120 300,190"/>
            <polygon id="face-left" class="face" points="150,120 150,320 300,390 300,190"/>
            <polygon id="face-right" class="face" points="300,190 300,390 450,320 450,120"/>

            <!-- Edges (12) -->
            <g id="edges" stroke="url(#edgeGrad)" fill="none">
              <line class="edge" id="e-a-b" x1="150" y1="120" x2="300" y2="50"/>
              <line class="edge" id="e-b-c" x1="300" y1="50" x2="450" y2="120"/>
              <line class="edge" id="e-c-d" x1="450" y1="120" x2="300" y2="190"/>
              <line class="edge" id="e-d-a" x1="300" y1="190" x2="150" y2="120"/>

              <line class="edge" id="e-e-f" x1="150" y1="320" x2="300" y2="250"/>
              <line class="edge" id="e-f-g" x1="300" y1="250" x2="450" y2="320"/>
              <line class="edge" id="e-g-h" x1="450" y1="320" x2="300" y2="390"/>
              <line class="edge" id="e-h-e" x1="300" y1="390" x2="150" y2="320"/>

              <line class="edge" id="e-a-e" x1="150" y1="120" x2="150" y2="320"/>
              <line class="edge" id="e-b-f" x1="300" y1="50" x2="300" y2="250"/>
              <line class="edge" id="e-c-g" x1="450" y1="120" x2="450" y2="320"/>
              <line class="edge" id="e-d-h" x1="300" y1="190" x2="300" y2="390"/>
            </g>

            <!-- Center point -->
            <circle id="centerPulse" class="center-pulse glow" cx="300" cy="220" r="34"/>
            <circle id="centerDot" class="center-dot glow" cx="300" cy="220" r="6"/>

            <!-- Nodes (8 vertices) -->
            <!-- Mapping keys to cube vertices -->
            <g id="nodes">
              <!-- top rim -->
              <g class="node" data-key="honey" transform="translate(150,120)">
                <circle r="10" fill="#ff7fb7"/><text class="label" x="14" y="4">Honey</text>
              </g>
              <g class="node" data-key="froot" transform="translate(300,50)">
                <circle r="10" fill="#9af2c9"/><text class="label" x="14" y="4">Froot</text>
              </g>
              <g class="node" data-key="clarity" transform="translate(450,120)">
                <circle r="10" fill="#98c8ff"/><text class="label" x="14" y="4">Clarity</text>
              </g>
              <g class="node" data-key="voice" transform="translate(300,190)">
                <circle r="10" fill="#b68cff"/><text class="label" x="14" y="4">Voice</text>
              </g>
              <!-- bottom rim -->
              <g class="node" data-key="mirrorhoney" transform="translate(150,320)">
                <circle r="10" fill="#b68cff"/><text class="label" x="14" y="4">MirrorHoney</text>
              </g>
              <g class="node" data-key="four" transform="translate(300,250)">
                <circle r="10" fill="#9af2c9"/><text class="label" x="14" y="4">Four</text>
              </g>
              <g class="node" data-key="wonder" transform="translate(450,320)">
                <circle r="10" fill="#ff7fb7"/><text class="label" x="14" y="4">Wonder ¬∑ Dua</text>
              </g>
              <g class="node" data-key="dagny" transform="translate(300,390)">
                <circle r="10" fill="#ff7fb7"/><text class="label" x="14" y="4">Bridge of Joy</text>
              </g>
            </g>
          </svg>
        </div>

        <div class="side">
          <div class="eyebrow">School Proximity</div>
          <div class="stat"><span>Progress</span><b id="progressPct">0%</b></div>
          <div class="stat"><span>Keys</span><b id="keysCount">0 / 8</b></div>
          <div class="feedback" id="feedback">Collect keys. Keys only light up if held on your device.</div>

          <div class="keys">
            <div class="key-row" id="keyRow"></div>
            <div class="fine">Long-press a card to toggle held. Tap a lit card to set how it was obtained.</div>
          </div>

          <div class="missing" id="missingBox"></div>
          <div class="fine">Edges brighten as proximity rises. The center pulse strengthens as you gather keys.</div>
        </div>
      </div>
    </section>
  </main>

<script>
  var KEY_DEFS = [
    {id:"honey",       label:"Honey",        color:"p"},
    {id:"froot",       label:"Froot",        color:"gr"},
    {id:"clarity",     label:"Clarity",      color:"b"},
    {id:"voice",       label:"Voice",        color:"v"},
    {id:"mirrorhoney", label:"MirrorHoney",  color:"v"},
    {id:"four",        label:"Four",         color:"gr"},
    {id:"wonder",      label:"Wonder ¬∑ Dua", color:"p"},
    {id:"dagny",       label:"Bridge of Joy",color:"p"}
  ];

  var METHODS = [
    {id:"found",  label:"found",  badge:"üß≠"},
    {id:"earned", label:"earned", badge:"‚≠ê"},
    {id:"gifted", label:"gifted", badge:"üíù"},
    {id:"echo",   label:"echo",   badge:"üêù"},
    {id:"link",   label:"link",   badge:"‚õìÔ∏è"}
  ];

  var STORAGE_KEY = "center.keys.state";
  function loadState(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");}catch(e){return{}} }
  function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }

  function ensureDefaults(){
    var s = loadState();
    KEY_DEFS.forEach(function(k){ if(!s[k.id]) s[k.id] = {held:false, method:"found"}; });
    if(s.earth){ delete s.earth; }
    saveState(s);
  }

  function methodBadge(id){
    var m = METHODS.find(function(x){return x.id===id}); return m ? (m.badge+" "+m.label) : "";
  }

  var keyRow = document.getElementById("keyRow");
  var pctLabel = document.getElementById("progressPct");
  var keysLabel = document.getElementById("keysCount");
  var feedback = document.getElementById("feedback");
  var missingBox = document.getElementById("missingBox");

  function buildKeys(){
    var s = loadState();
    keyRow.innerHTML = "";
    KEY_DEFS.forEach(function(k){
      var held = s[k.id].held, method = s[k.id].method;
      var card = document.createElement("div");
      card.className = "key" + (held ? "" : " dim");
      card.setAttribute("data-key", k.id);

      var left = document.createElement("div");
      left.className = "left";
      left.innerHTML = '<span class="dot '+k.color+'"></span><span class="titlekey">'+k.label+'</span>';

      var right = document.createElement("div");
      right.className = "method";
      var badge = document.createElement("span");
      badge.className = "badge";
      badge.textContent = held ? methodBadge(method) : "not held";

      var btn = document.createElement("button");
      btn.className = "edit";
      btn.textContent = held ? "edit" : "claim";
      if(!held) btn.setAttribute("disabled","");

      right.appendChild(badge); right.appendChild(btn);

      var selector = document.createElement("div");
      selector.className = "selector";
      METHODS.forEach(function(m){
        var id = "sel-"+k.id+"-"+m.id;
        var lab = document.createElement("label");
        lab.innerHTML = '<input type="radio" name="method-'+k.id+'" id="'+id+'" value="'+m.id+'" '+(method===m.id?'checked':'')+' />'+m.badge+' '+m.label;
        selector.appendChild(lab);
      });

      btn.addEventListener("click", function(){
        if(!loadState()[k.id].held) return;
        selector.style.display = selector.style.display==="block" ? "none" : "block";
      });
      selector.addEventListener("change", function(e){
        var st = loadState(); st[k.id].method = e.target.value; saveState(st);
        badge.textContent = methodBadge(st[k.id].method); selector.style.display="none"; update();
      });

      var pressTimer;
      card.addEventListener("mousedown", function(){
        pressTimer = setTimeout(function(){
          var st = loadState(); st[k.id].held = !st[k.id].held; saveState(st);
          if(st[k.id].held){ card.classList.remove("dim"); btn.removeAttribute("disabled"); btn.textContent="edit"; badge.textContent=methodBadge(st[k.id].method); }
          else { card.classList.add("dim"); btn.setAttribute("disabled",""); btn.textContent="claim"; badge.textContent="not held"; selector.style.display="none"; }
          update();
        }, 600);
      });
      ["mouseup","mouseleave","touchend","touchcancel"].forEach(function(ev){ card.addEventListener(ev, function(){ clearTimeout(pressTimer); }); });

      card.appendChild(left); card.appendChild(right); card.appendChild(selector);
      keyRow.appendChild(card);
    });
  }

  function computeProximity(){
    var st = loadState();
    var total = KEY_DEFS.length;
    var have = KEY_DEFS.filter(function(k){ return st[k.id].held; }).length;
    var pct = Math.round((have/total)*100);
    return {pct:pct, have:have, total:total};
  }

  function renderMissing(){
    var st = loadState();
    var missing = KEY_DEFS.filter(function(k){ return !st[k.id].held; });
    if(missing.length){
      var html = "Missing keys: " + missing.map(function(k){
        var dot = '<span class="dot '+k.color+'"></span>';
        return '<span class="chip">'+dot+k.label+'</span>';
      }).join(" ");
      missingBox.innerHTML = html;
    }else missingBox.innerHTML = "";
  }

  function setNodeLighting(){
    var st = loadState();
    document.querySelectorAll('#nodes .node').forEach(function(n){
      var id = n.getAttribute('data-key');
      if(st[id] && st[id].held){ n.classList.remove('dim'); n.querySelector('circle').classList.add('glow'); }
      else { n.classList.add('dim'); n.querySelector('circle').classList.remove('glow'); }
    });
  }

  function setEdgeBrightness(pct){
    var dim = pct<50;
    document.querySelectorAll('#edges .edge').forEach(function(e){
      if(dim) e.classList.add('dim'); else e.classList.remove('dim');
      e.setAttribute('stroke-width', String(1.2 + (pct/100)*1.1));
    });
    var pulse = document.getElementById('centerPulse');
    pulse.setAttribute('r', String(24 + pct*0.18));
    var dur = 3.0 - pct*0.015; if(dur<1.2) dur=1.2;
    pulse.style.animationDuration = String(dur)+'s';
    pulse.setAttribute('fill', 'rgba(255,215,106,'+(0.20 + pct*0.004)+')');
  }

  function updateUI(){
    var p = computeProximity();
    pctLabel.textContent = p.pct + "%";
    keysLabel.textContent = p.have + " / " + p.total;
    if(p.pct===0) feedback.textContent = "Collect keys. Keys only light up if held on your device.";
    else if(p.pct<50) feedback.textContent = "You are on the path. Keep gathering keys.";
    else if(p.pct<100) feedback.textContent = "Almost ready. A few keys remain.";
    else feedback.textContent = "All pre keys gathered. School listens for the right holder.";
    renderMissing();
    setNodeLighting();
    setEdgeBrightness(p.pct);
  }

  function update(){ updateUI(); }

  (function init(){
    ensureDefaults();
    buildKeys();
    update();
  })();
</script>
</body>
</html>
