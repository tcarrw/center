<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>T9 Signal Terminal ¬∑ PLNT Earth</title>
<meta name="theme-color" content="#00e0c6">
<style>
:root{
  --bg:#001616;
  --panel:#0a2020;
  --accent:#00e0c6;
  --accent2:#5af;
  --ink:#a8fff0;
  --muted:#66b3a9;
  --font:"VT323",monospace;
}
@import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
*{box-sizing:border-box;}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:var(--font);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  overflow-x:hidden;
}
header{
  text-align:center;
  padding:12px 8px 6px 8px;
  color:var(--accent);
  font-size:22px;
  letter-spacing:1px;
  text-shadow:0 0 6px var(--accent2);
  transition:all .6s ease;
}
#videoWrapper{
  position:relative;
  width:100%;
  max-width:520px;
  aspect-ratio:16/9;
  margin-top:12px;
  border:2px solid var(--accent2);
  box-shadow:0 0 10px #003 inset;
}
iframe{width:100%;height:100%;border:0;}
.video-controls{
  display:flex;justify-content:center;gap:8px;margin:8px 0;
}
.video-controls button{
  background:var(--panel);border:2px outset var(--accent2);color:var(--ink);
  font-family:var(--font);font-size:16px;padding:6px 14px;cursor:pointer;
}
.video-controls button:active{border:2px inset var(--accent2);background:#003;}
.window{
  background:var(--panel);
  border:2px solid var(--accent2);
  box-shadow:inset -2px -2px #001a1a,inset 2px 2px var(--accent2);
  padding:14px;
  margin:8px;
  max-width:520px;
  width:calc(100% - 32px);
}
.display{
  background:#000;
  color:var(--ink);
  padding:10px;
  border:2px inset var(--accent2);
  font-size:20px;
  text-align:center;
  min-height:36px;
  letter-spacing:2px;
  overflow-x:auto;
}
#modeToggle{
  width:100%;
  background:var(--accent);
  color:#001616;
  border:2px outset var(--accent2);
  font-family:var(--font);
  font-size:18px;
  padding:8px;
  cursor:pointer;
  margin:8px 0;
}
#modeToggle:active{border:2px inset var(--accent2);}
#breadcrumb{
  font-size:16px;
  color:var(--accent2);
  text-align:center;
  margin:6px 0;
  min-height:20px;
}
.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  margin-top:8px;
}
button.key{
  background:#1b1f1f;
  border:2px outset var(--accent2);
  color:var(--ink);
  font-family:var(--font);
  font-size:18px;
  padding:12px 0;
  cursor:pointer;
}
button.key:active{
  border:2px inset var(--accent2);
  background:#003;
}
#output{
  font-size:14px;
  color:var(--accent2);
  margin-top:8px;
  text-align:center;
  min-height:40px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  justify-content:center;
  padding:4px;
}
.choice{
  background:#1b1f1f;
  color:var(--ink);
  padding:4px 8px;
  border:1px solid var(--accent2);
  cursor:pointer;
  font-size:14px;
}
.choice:hover{
  background:var(--accent);
  color:#001616;
}
.controls{
  display:flex;
  justify-content:space-between;
  gap:6px;
  margin-top:8px;
}
.controls button{
  flex:1;
  background:#1b1f1f;
  border:2px outset var(--accent2);
  color:var(--ink);
  font-family:var(--font);
  font-size:16px;
  padding:8px;
  cursor:pointer;
}
.controls button:active{
  border:2px inset var(--accent2);
  background:#003;
}
.hints{
  margin:18px 8px;
  text-align:center;
  font-size:26px;
  line-height:1.6;
  max-width:520px;
}
.hint{margin:6px 0;transition:all 0.4s ease;}
.hint .emoji{
  opacity:0.3;filter:grayscale(100%);
  transition:opacity .4s,filter .4s,text-shadow .4s;
}
.hint.unlocked .emoji{
  opacity:1;filter:none;text-shadow:0 0 8px var(--accent2);
}
.details{
  margin-top:4px;
  font-size:14px;
  color:var(--accent2);
  animation:fadeIn .6s ease forwards;
}
.details .title{font-weight:bold;}
.details a{
  color:var(--accent2);
  text-decoration:none;
  font-size:12px;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(-3px);}to{opacity:1;transform:none;}}
#directory{
  margin-top:12px;
  padding:12px;
  border:2px solid var(--accent2);
  background:#000;
}
.entry{
  border-left:4px solid var(--accent);
  padding:8px 12px;
  margin:8px 0;
  text-align:left;
  background:var(--panel);
}
.entry a{color:var(--accent2);text-decoration:none;font-size:13px;}
.entry a:hover{text-decoration:underline;}
footer{
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin:20px 0 10px 0;
  opacity:0.7;
}
body::after{
  content:"";
  position:fixed;inset:0;
  background:repeating-linear-gradient(transparent 0 1px,rgba(0,255,255,0.03) 1px 2px);
  pointer-events:none;
  animation:flicker 1.5s infinite;
}
@keyframes flicker{50%{opacity:0.95;}100%{opacity:1;}}
</style>
</head>
<body>

<header id="header">T9 Signal Terminal ¬∑ PLNT Earth</header>

<div id="videoWrapper">
  <iframe id="ytplayer" src="https://www.youtube.com/embed/p2ZdeIKJA8c?enablejsapi=1&modestbranding=1&playsinline=1" 
    allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<div class="video-controls">
  <button id="playBtn">Play</button>
  <button id="loopBtn">Loop</button>
  <button id="muteBtn">Mute</button>
</div>

<div class="window">
  <input class="display" id="display" placeholder="Type letters or tap numbers">
  <button id="modeToggle">Mode: Encode</button>
  <div id="breadcrumb"></div>
  <div class="keypad" id="pad"></div>
  <div id="output"></div>
  <div class="controls">
    <button id="clearBtn">Clear</button>
    <button id="undoBtn">Undo</button>
    <button id="copyBtn">Copy</button>
  </div>
  <div id="directory"></div>
</div>

<div id="hints" class="hints"></div>

<footer>¬© PLNT Earth ¬∑ earth.plnt.earth ¬∑ This page returns to ground</footer>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player,audioCtx=null,loopEnabled=false,muted=false,osc128=null;

function onYouTubeIframeAPIReady(){
  player=new YT.Player('ytplayer',{events:{'onStateChange':onPlayerStateChange}});
}

document.getElementById('playBtn').onclick=()=>player.playVideo();
document.getElementById('loopBtn').onclick=()=>{loopEnabled=!loopEnabled;};
document.getElementById('muteBtn').onclick=()=>{muted=!muted;muted?player.mute():player.unMute();};

function onPlayerStateChange(e){
  if(e.data===YT.PlayerState.ENDED&&loopEnabled){player.playVideo();}
}

const t9DirectoryData=[
  {code:"456836926678837",name:"Ninajirachi ¬∑ I Love My Computer",emoji:"üóº",color:"#b8d8ff",url:"https://4562.world",tone:128,youtube:"RKybAhTw8iE",note:"üóº Dedicated to my computer and the Tower"},
  {code:"627462",name:"Marina ¬∑ Immortal",emoji:"ü¶ã",color:"#b8a3ff",url:"https://key.plnt.earth",tone:333,youtube:"dYGKxxTXqSs",note:"ü¶ã you are"},
  {code:"744743",name:"Sigrid ¬∑ A Driver Saved My Night",emoji:"ü™º",color:"#e9e7ff",url:"https://clarity.plnt.earth",tone:432,youtube:"sDEltzoEfZs",note:"ü™º keep driving"},
  {code:"32469",name:"Dagny ¬∑ Brightsider",emoji:"üå∏",color:"#f2b6d8",url:"https://joy.plnt.earth",tone:272,youtube:"BskeuUMp_lo",note:"üå∏ Green light on strawberry dreams"},
  {code:"7227462",name:"Sabrina Carpenter",emoji:"üçØ",color:"#f5cc6e",url:"https://honey.plnt.earth",tone:160},
  {code:"274262",name:"Ariana Grande",emoji:"üí®",color:"#eaeaea",url:"https://air.plnt.earth",tone:288},
  {code:"3825472",name:"Dua Lipa",emoji:"üî•",color:"#e74b3c",url:"https://fire.plnt.earth",tone:216},
  {code:"82956779438",name:"Taylor Swift",emoji:"üìö",color:"#f6e7a5",url:"https://school.plnt.earth",tone:432},
  {code:"64776664783",name:"Miss Monique",emoji:"üåä",color:"#55f6e6",url:"https://motion.plnt.earth",tone:512},
  {code:"3632444",name:"Doechii",emoji:"üí•",color:"#ff4d8a",url:"https://fire.plnt.earth",tone:320},
  {code:"287672",name:"AURORA",emoji:"‚ùÑÔ∏è",color:"#c3f0ff",url:"https://clarity.plnt.earth",tone:480},
  {code:"868356",name:"Tove Lo",emoji:"üíú",color:"#b03b6d",url:"https://dream.plnt.earth",tone:240},
  {code:"7672542",name:"Rosal√≠a",emoji:"üó°Ô∏è",color:"#a0142b",url:"https://knife.plnt.earth",tone:333},
  {code:"5467387",name:"Kim Petras",emoji:"ü™û",color:"#ff91c8",url:"https://mirror.plnt.earth",tone:384}
];

const display=document.getElementById('display');
const output=document.getElementById('output');
const breadcrumb=document.getElementById('breadcrumb');
const modeToggle=document.getElementById('modeToggle');
const clearBtn=document.getElementById('clearBtn');
const undoBtn=document.getElementById('undoBtn');
const copyBtn=document.getElementById('copyBtn');
const pad=document.getElementById('pad');
const header=document.getElementById('header');

let mode=localStorage.getItem('t9mode')||'encode';
let inputCache=localStorage.getItem('t9input')||'';
display.value=inputCache;

const t9map={2:['A','B','C'],3:['D','E','F'],4:['G','H','I'],5:['J','K','L'],6:['M','N','O'],7:['P','Q','R','S'],8:['T','U','V'],9:['W','X','Y','Z']};
const letterToNum={};
for(const [num,letters] of Object.entries(t9map)){
  for(const l of letters)letterToNum[l]=num;
}

let lockedPaths=[];

// Build keypad
for(let i=1;i<=9;i++){
  const b=document.createElement('button');
  b.className='key';
  const letters=t9map[i];
  if(letters) b.innerHTML=`${i}<br><small>${letters.join('')}</small>`;
  else b.textContent=i;
  b.onclick=()=>{playTone(128);display.value+=i;translate();};
  pad.appendChild(b);
}
const b0=document.createElement('button');
b0.className='key';
b0.innerHTML='*';
b0.onclick=()=>{playTone(128);display.value+='*';translate();};
pad.appendChild(b0);

const bZero=document.createElement('button');
bZero.className='key';
bZero.innerHTML='0';
bZero.onclick=()=>{playTone(128);display.value+='0';translate();};
pad.appendChild(bZero);

const bHash=document.createElement('button');
bHash.className='key';
bHash.innerHTML='#';
bHash.onclick=()=>{playTone(128);display.value+='#';translate();};
pad.appendChild(bHash);

updateModeText();
translate();
renderDirectory();
renderHints();

function playTone(freq){
  if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.type='sine';
  osc.frequency.value=freq;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  gain.gain.setValueAtTime(0.08,audioCtx.currentTime);
  osc.stop(audioCtx.currentTime+0.1);
}

function updateModeText(){
  modeToggle.textContent='Mode: '+(mode==='encode'?'Encode':'Decode');
}

function updateBreadcrumb(){
  breadcrumb.textContent=lockedPaths.length?lockedPaths.join(' ‚Üí '):'';
}

function setVideo(videoId){
  if(player && typeof player.loadVideoById==="function"){
    player.loadVideoById(videoId);
    player.playVideo();
  }
}

function translate(){
  const val=display.value.toUpperCase();
  localStorage.setItem('t9input',display.value);
  
  const found=t9DirectoryData.find(x=>val===x.code);
  if(found){
    output.innerHTML=`<div style="color:${found.color};font-size:16px;">‚ú® ${found.code} ‚Üí <a href="${found.url}" target="_blank" style="color:inherit;text-decoration:none;">${found.name}</a></div>`;
    breadcrumb.textContent=found.note||'';
    header.textContent=found.note||'T9 Signal Terminal ¬∑ PLNT Earth';
    updateDirectory(found);
    unlock(found.code);
    
    if(found.youtube){
      setVideo(found.youtube);
      loopEnabled=true;
    }
    
    if(found.code==="744743"){
      if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
      if(!osc128){
        osc128=audioCtx.createOscillator();
        const g=audioCtx.createGain();
        g.gain.value=0.08;
        osc128.type="sine";
        osc128.frequency.value=128;
        osc128.connect(g);
        g.connect(audioCtx.destination);
        osc128.start();
      }
    } else {
      if(osc128){osc128.stop();osc128.disconnect();osc128=null;}
    }
    return;
  }

  if(mode==='encode'){
    let res='';
    for(const ch of val){
      res+=letterToNum[ch]||ch;
    }
    output.textContent=res;
    breadcrumb.textContent='';
  }else{
    let combos=[''];
    for(const d of val){
      const letters=t9map[d];
      if(!letters){
        for(let i in combos)combos[i]+=d;
        continue;
      }
      const newC=[];
      for(const p of combos){
        for(const l of letters)newC.push(p+l);
      }
      combos=newC;
      if(combos.length>5000)break;
    }
    if(lockedPaths.length>0)
      combos=combos.filter(c=>c.startsWith(lockedPaths.join('')));
    renderChoices(combos);
    updateBreadcrumb();
  }
}

function renderChoices(list){
  output.innerHTML='';
  if(list.length===0){
    output.textContent='(no results)';
    return;
  }
  for(const item of list.slice(0,80)){
    const el=document.createElement('div');
    el.className='choice';
    el.textContent=item;
    el.onclick=()=>selectChoice(item);
    output.appendChild(el);
  }
}

function selectChoice(c){
  const p=lockedPaths.join('');
  if(c.startsWith(p)){
    const n=c[p.length];
    if(n){
      lockedPaths.push(n);
      translate();
    }
  }
}

undoBtn.onclick=()=>{
  lockedPaths.pop();
  translate();
};

modeToggle.onclick=()=>{
  mode=mode==='encode'?'decode':'encode';
  localStorage.setItem('t9mode',mode);
  lockedPaths=[];
  breadcrumb.textContent='';
  updateModeText();
  translate();
};

display.oninput=()=>{
  lockedPaths=[];
  translate();
};

clearBtn.onclick=()=>{
  display.value='';
  output.textContent='';
  lockedPaths=[];
  breadcrumb.textContent='';
  header.textContent='T9 Signal Terminal ¬∑ PLNT Earth';
  localStorage.removeItem('t9input');
  playTone(128);
  if(osc128){osc128.stop();osc128.disconnect();osc128=null;}
  loopEnabled=false;
};

copyBtn.onclick=()=>{
  let t='';
  if(mode==='encode'){
    t=output.textContent;
  }else{
    t=[...output.querySelectorAll('.choice')].map(c=>c.textContent).join(' ');
  }
  navigator.clipboard.writeText(t);
  playTone(256);
};

function updateDirectory(found){
  const dir=JSON.parse(localStorage.getItem('t9directory')||'[]');
  if(!dir.find(e=>e.code===found.code)){
    dir.push(found);
    localStorage.setItem('t9directory',JSON.stringify(dir));
  }
  renderDirectory();
}

function renderDirectory(){
  const dir=JSON.parse(localStorage.getItem('t9directory')||'[]');
  const c=document.getElementById('directory');
  if(dir.length===0){
    c.innerHTML='';
    return;
  }
  c.innerHTML='<h3 style="margin:0 0 8px 0;color:var(--accent);font-size:16px;">Discovered Signals</h3>';
  for(const e of dir){
    const card=document.createElement('div');
    card.className='entry';
    card.style.borderColor=e.color;
    card.innerHTML=`<strong style="color:${e.color}">${e.emoji} ${e.name}</strong><br><span style="color:var(--accent2)">${e.code}</span><br><a href="${e.url}" target="_blank">${e.url.replace('https://','')}</a><br><small>${e.tone} Hz</small>`;
    c.appendChild(card);
  }
}

function unlock(code){
  let unlocked=JSON.parse(localStorage.getItem('unlockedCodes')||"[]");
  if(!unlocked.includes(code)){
    unlocked.push(code);
    localStorage.setItem('unlockedCodes',JSON.stringify(unlocked));
  }
  renderHints();
}

function renderHints(){
  const unlocked=JSON.parse(localStorage.getItem('unlockedCodes')||"[]");
  const hints=t9DirectoryData.filter(d=>d.emoji);
  const html=hints.map(h=>{
    const open=unlocked.includes(h.code);
    return `
      <div class="hint ${open?'unlocked':''}">
        <div class="emoji">${h.emoji}</div>
        ${open?`<div class="details">
          <div class="title">${h.name}</div>
          <div class="note">${h.note||''}</div>
          ${h.url?`<a href="${h.url}" target="_blank">‚Üó open</a>`:''}
        </div>`:''}
      </div>`;
  }).join('');
  document.getElementById('hints').innerHTML=html;
}
</script>
</body>
</html>
